---
import Container from "../ui/Container.astro";
import Section from "../ui/Section.astro";
import { getSanityImageProps } from "../../lib/sanity/image";

export interface Props {
  block: {
    _type: "contentBlock";
    _key: string;
    title: string;
    content: any[]; // Portable text
    image?: any;
    imagePosition?: "left" | "right" | "top" | "bottom";
  };
}

const { block } = Astro.props;
const { title, content, image, imagePosition = "right" } = block;

const imageProps = image
  ? getSanityImageProps(image, { width: 600, height: 400 })
  : null;
---

<Section padding="lg" background="default">
  <Container>
    <div class={`content content--${imagePosition}`}>
      <div class="content__text">
        <h2 class="content__title">{title}</h2>
        <div class="content__body">
          {
            content.map((block) => {
              if (block._type === "block") {
                const Tag =
                  block.style === "h2"
                    ? "h2"
                    : block.style === "h3"
                      ? "h3"
                      : block.style === "blockquote"
                        ? "blockquote"
                        : "p";

                return (
                  <Tag
                    class={`content__paragraph content__paragraph--${block.style || "normal"}`}
                  >
                    {block.children?.map((child: any) => {
                      if (child._type === "span") {
                        if (child.marks?.includes("strong")) {
                          return <strong>{child.text}</strong>;
                        }
                        if (child.marks?.includes("em")) {
                          return <em>{child.text}</em>;
                        }
                        return child.text;
                      }
                      return "";
                    })}
                  </Tag>
                );
              }
              return "";
            })
          }
        </div>
      </div>

      {
        imageProps && (
          <div class="content__image">
            <img
              src={imageProps.src}
              alt={imageProps.alt}
              width={imageProps.width}
              height={imageProps.height}
              class="content__img"
            />
          </div>
        )
      }
    </div>
  </Container>
</Section>

<style>
  .content {
    display: grid;
    gap: var(--space-xl);
    align-items: center;
  }

  .content--top {
    grid-template-columns: 1fr;
  }

  .content--bottom {
    grid-template-columns: 1fr;
  }

  .content--left {
    grid-template-columns: 1fr 1fr;
  }

  .content--right {
    grid-template-columns: 1fr 1fr;
  }

  .content--bottom .content__image {
    order: 2;
  }

  .content--left .content__image {
    order: 1;
  }

  .content--left .content__text {
    order: 2;
  }

  .content__title {
    font-size: var(--step-5);
    font-weight: 600;
    margin-bottom: var(--space-l);
    color: var(--color-text);
  }

  .content__body {
    font-size: var(--step-1);
    line-height: var(--line-height-base);
    color: var(--color-text);
  }

  .content__paragraph {
    margin-bottom: var(--space-m);
  }

  .content__paragraph--h2 {
    font-size: var(--step-4);
    font-weight: 600;
    margin-top: var(--space-xl);
    margin-bottom: var(--space-m);
  }

  .content__paragraph--h3 {
    font-size: var(--step-3);
    font-weight: 600;
    margin-top: var(--space-l);
    margin-bottom: var(--space-s);
  }

  .content__paragraph--blockquote {
    font-style: italic;
    border-left: 4px solid var(--color-primary);
    padding-left: var(--space-m);
    margin: var(--space-l) 0;
  }

  .content__image {
    display: flex;
    justify-content: center;
  }

  .content__img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: var(--shadow-md);
  }

  @media (max-width: 768px) {
    .content--left,
    .content--right {
      grid-template-columns: 1fr;
    }

    .content--left .content__image,
    .content--left .content__text {
      order: unset;
    }
  }
</style>
